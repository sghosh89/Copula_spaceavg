---
title: "Supporting Information : Estimating synchronous and compensatory dynamics in grassland community using a novel “copula” approach"
author: "Shyamolina Ghosh"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=1.5cm,right=1.5cm,top=1.5cm,bottom=1.5cm"

output: 
  pdf_document:
    number_sections: yes
    keep_tex: yes
    fig_caption: yes

header-includes:
      - \usepackage{xr} \externaldocument[MT-]{MT_spatial_avg}
      - \input{head_supp.sty}

tables: True
link-citations: True
urlcolor : blue
indent : True
csl: pnas.csl
bibliography: REF_CSS.bib
---

\pagenumbering{roman}
\tableofcontents
\listoftables
\listoffigures

\pagebreak
\pagenumbering{arabic}

<!--Basic setup-->
```{r setup, echo=F, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
seed<-101
library(dplyr)
library(kableExtra)
library(stringr)
library(rmarkdown)
# families<-c(1,3:10,13,14,16:20)
source("mtime.R") #A function needed for caching
```

```{r prepare_data_jrg_spaceavg,echo=F,results="hide"}
set.seed(seed)

#---------------------------------data_cleaning for spatial avg data by year-----------------------------
d2<-as.data.frame(read.csv("./Data/jrg_data/JR_cover-by-year.csv",header = T))

data_jrg_spaceavg<-vector("list",1)
names(data_jrg_spaceavg)<-"jrg_spaceavg_cover_byyear"
s_s<-(as.character(unique(d2$species)))

sp_list<-vector("list",length(s_s))
names(sp_list)<-s_s
for(i in 1:length(s_s)){
  temp<-subset(d2, species==s_s[i])[,c("year","cover")]
  names(temp)<-c("Year","Dat")
  sp_list[[i]]<-temp
}
data_jrg_spaceavg$jrg_spaceavg_cover_byyear<-sp_list

#--------------------------time series plot for all sp with data_jrg_spaceavg-------------------------
summary_raw_data_spaceavg<-data.frame(sp=s_s,n=NA,n0=NA,nT=NA,nrep0=NA,cover=NA)
pdf("./Results/jrg_results/space_avg_cover_plot_all_sp.pdf",height=20,width = 20)
op<-par(mfrow=c(7,6),mar=c(3,3,3,3), mgp=c(1.5,0.5,0))
for(i in 1:length(data_jrg_spaceavg$jrg_spaceavg_cover_byyear)){
  temp<-data_jrg_spaceavg$jrg_spaceavg_cover_byyear[[i]]
  cover<-mean(temp$Dat,na.rm = T)
  n<-length(temp$Dat)
  nTies<-n-length(unique(temp$Dat))
  n0<-sum(temp$Dat==0)
  if(n0>0){
    nrep0<-n0-1
  }else{
    nrep0<-NA
  }   
  summary_raw_data_spaceavg$n[i]<-n
  summary_raw_data_spaceavg$n0[i]<-n0
  summary_raw_data_spaceavg$nT[i]<-nTies
  summary_raw_data_spaceavg$nrep0[i]<-nrep0
  summary_raw_data_spaceavg$cover[i]<-cover
  plot(temp$Year,temp$Dat,col=rgb(1,0,0,0.3),pch=19)
  mtext(paste0(s_s[[i]],", nT=",nTies,", nrep0=",nrep0,", cover=",round(cover,3),sep=""))
}
par(op)
dev.off()

#--------------------screening species for data_jrg_spaceavg----------------------------
id_common_sp_jrg<-which(summary_raw_data_spaceavg$n0<=6 & summary_raw_data_spaceavg$n==36)
id_not_common_sp_jrg<-setdiff(c(1:42),id_common_sp_jrg)

bad_id<-which(names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear) %in% c("BARE","ROCK"))

id_common_sp_jrg<-setdiff(id_common_sp_jrg,bad_id)
id_not_common_sp_jrg<-setdiff(id_not_common_sp_jrg,bad_id)

id_rare_sp_jrg<-which(summary_raw_data_spaceavg$n0>=34)
id_normal_sp_jrg<-setdiff(id_not_common_sp_jrg,id_rare_sp_jrg)

tot_sp_jrg<-length(id_common_sp_jrg)+length(id_not_common_sp_jrg)+length(bad_id)
tot_sp_jrg==42

tot_sp_jrg<-length(id_common_sp_jrg)+length(id_normal_sp_jrg)+length(id_rare_sp_jrg)+length(bad_id)
tot_sp_jrg==42
#----------------------------------------------------------------------------------------------
splist_jrg_spaceavg<-id_common_sp_jrg
lensp<-length(splist_jrg_spaceavg)
#---------------------generate copula plots for all selected splist_jrg_spaceavg--------------------
source("./vivj_matrix.R")
#pdf("./Results/jrg_results/copula_splist_jrg_spaceavg_with_drivers.pdf",height=2*lensp,width = 2*lensp)
pdf("./Results/jrg_results/copula_splist_jrg_spaceavg.pdf",height=2*lensp,width = 2*lensp)
op<-par(mfrow=c(lensp,lensp),mar=c(3,3,3,3), mgp=c(1.5,0.5,0))
for(i in c(1:lensp)){
  for(j in c(1:lensp)){
    vivj_matrix(d_allsp=data_jrg_spaceavg,loc=1,
                i=splist_jrg_spaceavg[i],j=splist_jrg_spaceavg[j],level=0.05,
                ploton=T,timeavg=F,tagon=F)
  }
}
par(op)
dev.off()
#saveRDS(data_jrg_spaceavg,"./Results/jrg_results/data_jrg_spaceavg_with_drivers.RDS")
#saveRDS(splist_jrg_spaceavg_with_drivers,"./Results/jrg_results/goodsplist_jrg_spaceavg_with_drivers.RDS")

saveRDS(data_jrg_spaceavg,"./Results/jrg_results/data_jrg_spaceavg.RDS")
saveRDS(splist_jrg_spaceavg,"./Results/jrg_results/common_sp_jrg_spaceavg.RDS")
```

<!--## Results for data_jrg_spaceavg

### Model selection calculation for jrg data_spaceavg-->

```{r ms_jrg_spaceavg,echo=F, cache=T, cache.extra=list(seed,data_jrg_spaceavg,splist_jrg_spaceavg,mtime("FittingCopula_ms.R"), mtime("vivj_matrix.R"),mtime("OurBiCopSelect.R"),mtime("MyBiCopGofTest.R"),mtime("preprocessors.R"))}
source("./FittingCopula_ms.R") # top most hierarchy source file

set.seed(seed)
#-----------------------------Model selection approach for data_jrg_spaceavg-----------------------
source("FittingCopula_ms.R") # top most hierarchy source file

RES_jrg_spaceavg<-RES_single_loc(loc=1,d_allsp=data_jrg_spaceavg,
                                 good_sp=splist_jrg_spaceavg,
                                 families=c(1,3:10,13,14,16:20),level=0.05,timeavg=F)

saveRDS(RES_jrg_spaceavg,"./Results/jrg_results/RES_jrg_spaceavg.RDS")
```

```{r plot_LTmUT_jrg_spaceavg, echo=F,results="hide",message=F}
set.seed(seed)
source("./mycorrplot.R")

nvar<-0
#nvar<-nvar_jrg_spaceavg
#nvar_names_jrg_spaceavg<-c("grs_ppt","grs_tmean","grs_tmax","grs_tmin")

pdf("./Results/jrg_results/LTmUT_jrg_spaceavg.pdf",height=15,width=15)
z<-RES_jrg_spaceavg$LTmUTdep
rownames(z)<-paste0(rownames(z)," : ",names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear[splist_jrg_spaceavg]),sep="")
#dl<-nrow(z)-nvar+1
#rownames(z)[c(dl:nrow(z))]<-nvar_names
colnames(z)<-rownames(z)
cmin<-min(RES_jrg_spaceavg$LTmUTdep,na.rm=T)
cmax<-max(RES_jrg_spaceavg$LTmUTdep,na.rm=T)
cr<-max(abs(cmin),abs(cmax))
mycorrplot(z=z,
           posnI_ind = RES_jrg_spaceavg$posnI_ind,
           posnN_ind = RES_jrg_spaceavg$posnN_ind,
           colrange = c(-cr,cr),
           nsm=RES_jrg_spaceavg$neg_sp_mat)
dl2<-nrow(z)-nvar
z1<-z
z1[RES_jrg_spaceavg$posnN_ind]<-NA
z1<-z1[1:dl2,1:dl2]
nL<-sum(z1>0,na.rm = T)
nU<-sum(z1<0,na.rm = T)
ipos<-which(z1>0,arr.ind = T)
ineg<-which(z1<0,arr.ind=T)
fL<-sum(z1[ipos])/(sum(z1[ipos])+abs(sum(z1[ineg])))
fU<-abs(sum(z1[ineg]))/(sum(z1[ipos])+abs(sum(z1[ineg])))
mtext(paste0("nL =",nL,", nU =",nU),cex=3,side=1,line=1)
#segments(x0=c(0.5, 0.5), y0=c(0.5+nvar, 0.5+nrow(z)), x1=c(0.5+nrow(z), 0.5+nrow(z)), y1=c(0.5+nvar,0.5+nrow(z)), lwd=6,col="green")
#segments(c(0.5,0.5+nrow(z)), rep(0.5+nvar,1), c(0.5,0.5+nrow(z)), rep(0.5+nrow(z),1), lwd=6, col="green")
dev.off()
```

<!--### Non-parametric analysis for jrg data_spaceavg-->

```{r npa_jrg_spaceavg, echo=F, cache=T, cache.extra=list(seed,data_jrg_spaceavg,splist_jrg_spaceavg,mtime("NonParamStat.R"),mtime("vivj_matrix.R"),mtime("CopulaFunctions.R"), mtime("CopulaFunctions_flexible.R"))}

set.seed(seed) 
source("./NonParamStat.R")

resloc<-"./Results/jrg_results/jrg_npa_results/"
loc<-1

stat_jrg_npa_spaceavg<-vector("list",1)
names(stat_jrg_npa_spaceavg)<-"jrg_spaceavg"

if (!dir.exists(paste(resloc,names(stat_jrg_npa_spaceavg),sep=""))){
  dir.create(paste(resloc,names(stat_jrg_npa_spaceavg),sep=""))
}

stat_jrg_spaceavg<-multcall(d_allsp=data_jrg_spaceavg,
                          loc=1,
                          pfname=paste(resloc,names(stat_jrg_npa_spaceavg),"/",names(stat_jrg_npa_spaceavg),sep=''),
                          good_sp=splist_jrg_spaceavg,
                          nbin=2,timeavg=F)
  
stat_jrg_npa_spaceavg[[loc]]<-stat_jrg_spaceavg

saveRDS(stat_jrg_npa_spaceavg,paste(resloc,names(stat_jrg_npa_spaceavg),"/",file="stat_jrg_npa_spaceavg.RDS",sep=''))
```

```{r plot_res_jrg_npa_spaceavg, echo=F, results="hide",cache=T,warning=F, cache.extra=list(seed,stat_jrg_npa_spaceavg,mtime("NonParamStat_matrixplot.R"),mtime("mycorrplot.R"))}
set.seed(seed)
source("./NonParamStat_matrixplot.R")
r<-readRDS("./Results/jrg_results/RES_jrg_spaceavg.RDS")
resloc<-"./Results/jrg_results/jrg_npa_results/"

nvar<-0
nvar_names<-NA

npa_diff_jrg_spaceavg<-NonParamStat_matrixplot(data_ln_all = stat_jrg_npa_spaceavg,
                                                  posnI_list_ln_all = list(r$posnI_ind),
                                                  posnN_list_ln_all = list(r$posnN_ind),
                                                  resloc=paste(resloc,sep=""),
                                                  nvar=nvar,nvar_names=nvar_names,r=list(r),tagon=F)
saveRDS(npa_diff_jrg_spaceavg,paste(resloc,file="npa_diff_jrg_spaceavg.RDS",sep=''))
```

```{r jrg_spaceavg_some_figs,echo=F,results="hide"}
source("vivj_matrix.R")

#invasion effect
pdf("./Results/jrg_results/jrg_spaceavg_BRMO_PLER.pdf",height=3,width=8)
op<-par(mfrow=c(1,2),mar=c(4,5,3,3))
i<-6
j<-31
d_allsp<-data_jrg_spaceavg

vivj_matrix(d_allsp = d_allsp,loc=1,i=i,j=j,ploton=T,timeavg=F,tagon=T)

ylabel<-paste("-",names(d_allsp[[loc]])[j],sep="")
s1<-vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=F,timeavg=F,tagon=T)
plot(s1$mat[,1],s1$mat[,2],col=rgb(0,0,0,0),pch=19,xlab=names(d_allsp[[1]])[i],ylab=ylabel,cex.lab=1.5)
text(s1$mat[,1],s1$mat[,2],labels = c(1983:2018),cex=0.5,col="blue")
par(op)
dev.off()


#interspecies competition
pdf("./Results/jrg_results/jrg_spaceavg_HELU_LOSU.pdf",height=3,width=4)
op<-par(mar=c(4,5,3,3))
i<-17
j<-24
d_allsp<-data_jrg_spaceavg
s1<-vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=F,timeavg=F,tagon=T)
plot(s1$mat[,1],s1$mat[,2],col=rgb(0,0,0,0),pch=19,xlab=names(d_allsp[[1]])[i],
     ylab=names(d_allsp[[1]])[j],cex.lab=1.5)
text(s1$mat[,1],s1$mat[,2],labels = c(1983:2018),cex=0.5,col="blue")
mtext(paste0("(sp_x, sp_y) = (",i," , ",j,")"),
          side = 3, line=0.15, adj=0.5, col="black")
par(op)
dev.off()

pdf("./Results/jrg_results/jrg_spaceavg_HELU_MIDO.pdf",height=3,width=8)
op<-par(mfrow=c(1,2),mar=c(4,5,3,3))
i<-17
j<-28
d_allsp<-data_jrg_spaceavg

vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=T,timeavg=F,tagon=T)

ylabel<-paste("-",names(d_allsp[[loc]])[j],sep="")
s1<-vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=F,timeavg=F,tagon=T)
plot(s1$mat[,1],s1$mat[,2],col=rgb(0,0,0,0),pch=19,xlab=names(d_allsp[[1]])[i],
     ylab=ylabel,cex.lab=1.5)
text(s1$mat[,1],s1$mat[,2],labels = c(1983:2018),cex=0.5,col="blue")
par(op)
dev.off()

pdf("./Results/jrg_results/jrg_spaceavg_LOSU_MIDO.pdf",height=3,width=8)
op<-par(mfrow=c(1,2),mar=c(4,5,3,3))
i<-24
j<-28
d_allsp<-data_jrg_spaceavg

vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=T,timeavg=F,tagon=T)

ylabel<-paste("-",names(d_allsp[[loc]])[j],sep="")
s1<-vivj_matrix(d_allsp=d_allsp,loc=1,i=i,j=j,ploton=F,timeavg=F,tagon=T)
plot(s1$mat[,1],s1$mat[,2],col=rgb(0,0,0,0),pch=19,xlab=names(d_allsp[[1]])[i],
     ylab=ylabel,cex.lab=1.5)
text(s1$mat[,1],s1$mat[,2],labels = c(1983:2018),cex=0.5,col="blue")
par(op)
dev.off()
```

```{r skewness_jrg_spaceavg, echo=F, results="hide", warning=F, cache=T, cache.extra=list(seed,data_jrg_spaceavg,mtime("skewness_testing.R"),mtime("ncsurrog.R"))}
#we suppressed the warning coming from ncsurrog by using warning=F in chunk header 
# Kendall does not handle ties so we didn't use that
set.seed(seed)
source("skewness_testing.R")

# Generate matrix which holds timeseries for all 42 species along each of 42 column : 36 by 42 matrix
splist<-c(1:42)
ts_mat<-c()
for(i in splist){
  #cat("sp=",names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear)[[i]],"\n")
  temp<-data_jrg_spaceavg$jrg_spaceavg_cover_byyear[[i]]$Dat
  # NOTE : for i=20, LASP has only 2014-2018 cover information : I assumed NA for rest of the year
  # but then it can't handle with ncsurrog so if you want to include LASP then use 0 for 1983-2013
  if(names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear)[[i]]=="LASP"){
    fillup<-NA*numeric(length(1983:2013))
    temp<-append(fillup,temp)
  }
  ts_mat<-cbind(ts_mat,temp)
}
rownames(ts_mat)<-c(1983:2018)
colnames(ts_mat)<-names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear)[splist]

# Now see the total cover time-series with different species list
#---------------------------------------------------------------------------------------------
ts_mat_common_sp_jrg<-ts_mat[,id_common_sp_jrg]
total_ts_common_sp_jrg<-apply(ts_mat_common_sp_jrg,MARGIN = 1,FUN = sum)
#----------------------------------------------------------------------------------------
id_common_and_normal_sp_jrg<-sort(c(id_common_sp_jrg,id_normal_sp_jrg))

ts_mat_common_and_normal_sp_jrg<-ts_mat[,id_common_and_normal_sp_jrg]
total_ts_common_and_normal_sp_jrg<-apply(ts_mat_common_and_normal_sp_jrg,MARGIN = 1,FUN = sum, na.rm=T)

id_all_sp_jrg<-sort(c(id_common_sp_jrg,id_normal_sp_jrg, id_rare_sp_jrg))
ts_mat_all_sp_jrg<-ts_mat[,id_all_sp_jrg]
total_ts_all_sp_jrg<-apply(ts_mat_all_sp_jrg,MARGIN = 1,FUN = sum,na.rm=T)

id_LASP<-which(colnames(ts_mat_all_sp_jrg)=="LASP")
ts_mat_all_sp_except_LASP<-ts_mat_all_sp_jrg[,-id_LASP]
total_ts_all_sp_except_LASP<-apply(ts_mat_all_sp_except_LASP,MARGIN = 1,FUN = sum,na.rm=T)

total_ts<-cbind(total_ts_common_sp_jrg,total_ts_common_and_normal_sp_jrg,total_ts_all_sp_jrg,total_ts_all_sp_except_LASP)

pdf("./Results/jrg_results/skewness_results/total_timeseries.pdf",height=6,width=6)
plot(c(1983:2018),total_ts[,1],ylim=range(total_ts),col=rgb(1,0,0,0.5),type="b",pch=16,xlab="Years",ylab="Total % cover",xlim=c(1983,2018))
lines(c(1983:2018),total_ts[,2],type="b",pch=16,col=rgb(0,1,0,0.5))
lines(c(1983:2018),total_ts[,3],type="b",pch=16,col=rgb(0,0,1,0.5))
lines(c(1983:2018),total_ts[,3],type="l",col="black")
legend("bottomright",c("common sp.","common + normal sp.","all sp. including rare", "all sp. except LASP"),lty=c(1,1,1,1),
       col=c(rgb(1,0,0,0.5),rgb(0,1,0,0.5),rgb(0,0,1,0.5),"black"),pch=c(16,16,16,NA),bty="n",cex=1)
dev.off()

#--------------------------Now calculate skewness results with common species only----------------------------------------
resloc<-"./Results/jrg_results/skewness_results/"
tempo<-paste(resloc,"common_sp_",ncol(ts_mat_common_sp_jrg),sep="")

if (!dir.exists(tempo)){
  dir.create(tempo)
}
resloc2<-paste(tempo,"/",sep="")

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_plotcheckon_sp_",ncol(ts_mat_common_sp_jrg),".pdf",sep=""),height=6,width=6)
ans<-skewness_testing(ts_matrix = ts_mat_common_sp_jrg,splist = c(1:ncol(ts_mat_common_sp_jrg)),numsurrog = 10000, ploton=F, 
                      plotcheckon=T, corpres = "spearman",resloc=resloc2)
# this histogram should have its peak ~0.5, with range nearly (0.47-0.52)
dev.off()

saveRDS(ans,paste(resloc2,"skewness_jrg_spaceavg_spearman_common_sp_",ncol(ts_mat_common_sp_jrg),".RDS",sep="")) 

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_sp_",ncol(ts_mat_common_sp_jrg),".pdf",sep=""),height=6,width=6)
op<-par(mar=c(5.1, 5.1, 4.1, 2.1))
hist(ans$surrogskw,breaks = 100,main="",xlab="Surrogate skewness",ylab="Frequency",cex.lab=2,cex.axis=2,col="grey",border=F)
abline(v=ans$realskw,col="black")
mtext(paste0("p = ",round(ans$p_left,4),sep=""), side = 3, line=-2, adj=0.8)
dev.off()

#--------------------------Now calculate skewness results with common and normal species except LASP-------------------------

id_LASP<-which(colnames(ts_mat_common_and_normal_sp_jrg)=="LASP")
mymat<-ts_mat_common_and_normal_sp_jrg[,-id_LASP]
resloc<-"./Results/jrg_results/skewness_results/"
tempo<-paste(resloc,"common_and normal_sp_except_LASP_",ncol(mymat),sep="")

if (!dir.exists(tempo)){
  dir.create(tempo)
}
resloc2<-paste(tempo,"/",sep="")

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_plotcheckon_sp_",ncol(mymat),".pdf",sep=""),height=6,width=6)
ans<-skewness_testing(ts_matrix = mymat,splist = c(1:ncol(mymat)),numsurrog = 10000, ploton=F, 
                      plotcheckon=T, corpres = "spearman",resloc=resloc2)
# this histogram should have its peak ~0.5, with range nearly (0.47-0.52)
dev.off()

saveRDS(ans,paste(resloc2,"skewness_jrg_spaceavg_spearman_common_sp_",ncol(mymat),".RDS",sep="")) 

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_sp_",ncol(mymat),".pdf",sep=""),height=6,width=6)
op<-par(mar=c(5.1, 5.1, 4.1, 2.1))
hist(ans$surrogskw,breaks = 100,main="",xlab="Surrogate skewness",ylab="Frequency",cex.lab=2,cex.axis=2,col="grey",border=F)
abline(v=ans$realskw,col="black")
mtext(paste0("p = ",round(ans$p_left,4),sep=""), side = 3, line=-2, adj=0.8)
dev.off()


#----------------------Now calculate skewness results with all species except LASP---------------------------------

resloc<-"./Results/jrg_results/skewness_results/"
tempo<-paste(resloc,"all_sp_except_LASP_",ncol(ts_mat_all_sp_except_LASP),sep="")

if (!dir.exists(tempo)){
  dir.create(tempo)
}
resloc2<-paste(tempo,"/",sep="")

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_plotcheckon_sp_",ncol(ts_mat_all_sp_except_LASP),".pdf",sep=""),height=6,width=6)
ans<-skewness_testing(ts_matrix = ts_mat_all_sp_except_LASP,splist = c(1:ncol(ts_mat_all_sp_except_LASP)),numsurrog = 10000, ploton=F, 
                      plotcheckon=T, corpres = "spearman",resloc=resloc2)
# this histogram should have its peak ~0.5, with range nearly (0.47-0.52)
dev.off()

saveRDS(ans,paste(resloc2,"skewness_jrg_spaceavg_spearman_common_sp_",ncol(ts_mat_all_sp_except_LASP),".RDS",sep="")) 

pdf(paste(resloc2,"skewness_jrg_spaceavg_spearman_sp_",ncol(ts_mat_all_sp_except_LASP),".pdf",sep=""),height=6,width=6)
op<-par(mar=c(5.1, 5.1, 4.1, 2.1))
hist(ans$surrogskw,breaks = 100,main="",xlab="Surrogate skewness",ylab="Frequency",cex.lab=2,cex.axis=2,col="grey",border=F)
abline(v=ans$realskw,col="black")
mtext(paste0("p = ",round(ans$p_left,4),sep=""), side = 3, line=-2, adj=0.8)
dev.off()
```































# Data \label{Data} 


<!--JRG data : Lauren will add this section and then I can write how I screened 15 species out of 42-->


<!--Hays data-->
Every year from 1932-1972, researchers from Fort Hays State University, 
in Hays, Kansas, mapped all individual plants in a series 
of 1 sq. meter quadrats in a mixed grass prairie (38.8$^\circ$N, 99.3$^\circ$W) 
[@albertson1937ecology; @albertson1965vegation]. In fact, data produced 
using the pantograph technique can be used the same way as data generated by tagging
individual plants, with spatial coordinates substituting for tags. 
The Hays data set later had been digitized [@adler2007long] and is now available
[online](http://esapubs.org/archive/ecol/E088/161/). $41$ years (1932-1972)
long spatio-temporal data was widely used in earlier studies to understand plant demographic process. 
Here we will give a brief description of the [data](http://esapubs.org/archive/ecol/E088/161/).
`allrecords.csv` is basal cover (area in $cm^2$)
datasets for 151 unique species (when observed) recorded for 41 years from 51 (1m $\times$ 1m) quadrats.
Counts for each unique species occurred in the entire `allrecords.csv` dataset 
were stored in `species_list.csv` file with categories like `type`, `PLANTS.Symbol`,
`PLANTS.Synonym` (for explanation see [`metadata file`](http://esapubs.org/archive/ecol/E088/161/metadata.htm)). 
5 of 151 species were classified in `'remove'` category as mentioned in `type` column of `species_list.csv`. They were non-plant species
like `Bare ground`, `Fragment` and other unidentified sp. like `Mixed grass`, `Polygonum spp.` (only occurred once), `Unknown`.

Among 51 quadrats, 36 permanent quadrats were arranged along a gradient of soil depth and located in two livestock exclosures
("e1" and "e2"). Rest 15 quadrats were located in grazed areas outside the exclosures, mostly in the 
shortgrass community. Location of 51 quadrats were recorded as (quadX $cm$, quadY $cm$)
in East-West and North-South direction, respectively relative to the south-west corner 
of exclosure "e1" (see `quadrat_info.csv`). Each quadrat have some polygons with ID number processed 
in GIS tracking position for individual plants. 
Each polygon location was recorded as centroid co-ordinate (x $cm$, y $cm$) of 
corresponding polygon (see `allrecords.csv`). 

For our purpose, we calculated average basal cover over the quadrats surveyed for each year for 
each 146 species (excluding the `remove` category from 151 species list). For tail dependence results,
we considered average basal cover time series for $20$ most common species which had at least $35$ years 
of finite data.


# Methods \label{Methods} 

<!--model selection approach : more or less similar with BIVAN paper-->
## Model selection approach \label{model_sel}

Model selection approach was used to measure tail-dependence for each bivariate copula 
taken pairwise from a multivariate dataset.
To see temporal dynamics in a community, a bivariate copula was 
made of spatially averaged
(over 216 plots) percent cover data of any two 
species (or with any environmental factors) through out 36 years,
thereby containing 36 data points. 
Then the copula was fitted 
via a model selection procedure to a variety of copulas, to be precise, 
a set of 16 copula-family.
Fits of the various copula models 
were compared via the Akaike Information Criteria (AIC). 

For our model selection procedure, we used 
several one- and two-parameter families of copulas exhibiting 
a wide variety of 
positive lower-tail dependence values 
(Clayton, survival-Gumbel, survival-Joe, survival-BB6, henceforth
abbreviated, respectively, C, SG, SJ, SBB6) and upper-tail dependence values
(survival-Clayton, Gumbel, Joe, BB6, henceforth abbreviated, respectively, 
SC, G, J, BB6). We also considered families that could exhibit 
positive upper- or lower-tail
dependence, or both, depending on parameters (BB1, survival-BB1, BB7,
survival-BB7, henceforth 
abbreviated, respectively, BB1, SBB1, BB7, SBB7). 
If LT and UT are used to denote 
our two measures of tail dependence, their difference is a measure of asymmetry of 
tail dependence. We also used two families that were asymmetric in their non-tail parts, 
but that had zero tail dependence (BB8, survival-BB8, abbreviated BB8 and SBB8).
Normal copula, having zero tail-dependence (both in lower and
upper tail), served as a benchmark to measure tail depen-
dence between any bivariate asymmetric copula considered.
In addition to the normal copula, we used another symmetric copula,
the Frank copula (abbreviated F). 
Copulas are implemented in the `copula` and `VineCopula` packages for the 
R statistical computing language.
Additional details are in introductory texts 
on copulas [@nelsen2006_copula ; @joe2014_dependence] 
and in `VineCopula` documentation.

For a bivariate dataset $(x_i,y_i)$ for $i=1,...,n$, 
model selection involved several steps.
First, we produced ranks 
$(\tilde{u}_i,\tilde{v}_i)$ where $\tilde{u}_i$ is the rank of $x_i$ in the set 
$\{x_i:i=1,...,n\}$ and $\tilde{v}_i$ is the rank of $y_i$ in the set $\{y_i:i=1,...,n\}$ and 
we set $u_i=\tilde{u}_i/(n+1)$ and $v_i=\tilde{v}_i/(n+1)$; subsequent analysis used these 
*normalized ranks* $u_i$ and $v_i$. Ranks were $1$ for the smallest element in a set. 
Second, we did a test of the independence of the $u_i$ and $v_i$ 
(implemented in `BiCopIndTest` in the `VineCopula` package). 
Subsequent model selection algorithms are ineffective 
if data could not be distinguished from independent data 
since most or all bivariate copula families we considered 
include the independent copula in the 
family or as a boundary case. If independence could be rejected 
($0.05$ significance level), model 
selection proceeded. Third, we fit the bivariate copula families
listed previously to the ranked data 
$(u_i,v_i)$ via maximum likelihood, using the `BiCopEst` function
in `VineCopula`, and 
obtained AIC values and accompanying model weights, $\text{AIC}_{\text{w}}$
[@burnham2003_modelselection]. The weight of a model represents the 
relative support of data for the model; weights sum to 1 
across models considered. The lower- and 
upper-tail dependence of the best-fitting member of 
each family was also provided by `BiCopEst`. 
Fourth, $\text{AIC}_{\text{w}}$ values for all fitted models
were used to get model-averaged lower- and upper-tail dependence
values using standard model averaging 
formulas [@burnham2003_modelselection].

If initial data $(x_i,y_i)$ were negatively correlated,
then we first transformed the second variable $(y_i)$ as $(- y_i)$, so that 
$(x_i,-y_i)$ were positively correlated and then computed their 
normalized rank and proceeded with the approach stated above. 
This transformation was carried out to preserve the sense of lower- 
or upper-tail dependence notation throughout the paper.

Model selection methods will give the *relative* support of 
several models, but will not,
on their own, indicate whether any of the models selected is an
objectively good fit: all 
models considered might poorly describe the data. 
To test this, and as the final step of
our procedure, we tested the goodness of fit of our AIC-best copula family using a 
bootstrapping procedure implemented in `BiCopGofTest` of `VineCopula`. 
The method performed two tests, one based on a Cramer-von Mises statistic,
and one based on a 
Kolmogorov-Smirnov statistic. To keep computation times reasonable, 
an initial run using $100$ bootstraps was performed, and if
the $p$-value resulting from either test was less than $0.2$, tests were re-run with 
$1000$ boostraps.

For multivariate community datasets,
we compared AIC weights and tail-dependence of 
minimum-AIC copulas with that of the normal copula.
Model averaged lower minus upper tail dependence as
multi-species interaction matrix was presented pictorially
to understand inter-species dynamics (e.g. 
Figs. \ref{MT-fig_LTmUT_spaceavg_jrg} and \ref{MT-fig_LTmUT_spaceavg_hays} in main text)
We also counted the number of species pairs (only positively
correlated plant-species pairs were considered)
for which model-averaged lower-tail dependence was greater 
than model-averaged upper-tail dependence ($nL$)
or vice-versa ($nU$), and reported the percentage 
of pairs showing stronger
lower-tail dependence out of 
the total number non-independent 
species pairs considered. 

<!--non-parametric analysis  : more or less similar with BIVAN paper-->
## Nonparametric approach \label{nonparam}

In addition to our model selection approach, we also used nonparametric approaches to 
quantify lower- and upper-tail dependence. Using two approaches can provide greater confidence 
that results are robust. We used three nonparametric
statistics which can quantify the extent to which 
two normalized ranks $u_i$ and $v_i$ are 
related in any part of their distributions; we here describe the 
statistics. The statistics were formulated with positively associated
variables in mind. So definitions and associated 
diagrams will assume positive associations, though generalizations are 
straightforward. Given two bounds 
$0 \leq l_b < u_b \leq 1$, we define the parallel lines $u+v=2l_b$ and 
$u+v=2u_b$, which intersect the unit square (Fig. \ref{fig_stat_image}). 
Our statistics quantify the dependence
between $u_i$ and $v_i$ in the region bounded by these lines.
Using $l_b=0$ and some value $u_b\leq 0.5$ can give information about 
dependence in the left parts of the distributions of $u$ and $v$, and 
using $u_b=1$ and $l_b \geq 0.5$ can give information about dependence in 
the right parts of the distributions. 
The first statistic, denoted $\cor_{l_b,u_b}(u,v)$, is the portion of the Spearman 
correlation of $u_i$ and $v_i$ that is attributable to the points 
lying in the region given by the bounds $u+v=2l_b$ and $u+v=2u_b$:
\begin{equation}\label{eq.Cor}
   \cor_{l_b,u_b}(u,v) = \frac{\sum 
   (u_i-\mean(u)) (v_i-\mean(v))}{(n-1)\sqrt{\var(u)\var(v)}}.
\end{equation}
\noindent Here means and sample variances are computed using all $n$ data 
points, but the
sum is over only the indices $i$ for which $u_i+v_i > 2l_b$ and 
$u_i+v_i < 2u_b$. 
Larger values of $\cor_{l_b,u_b}$ indicate stronger positive association
between $u$ and $v$ in the region given by the bounds. The sum of 
$\cor_{0,0.5}(u,v)$ and $\cor_{0.5,1}(u,v)$ (or some other choice of 
$\cor_{l_{b_k},u_{b_k}}(u,v)$ for bounds $l_{b_k},u_{b_k}$ that partition the
interval $(0,1)$) equals the standard Spearman correlation. 

We also defined a statistic $\Ps_{l_b,u_b}$, 
which has a similar 
interpretation to $\cor_{l_{b_k},u_{b_k}}(u,v)$; we use both statistics 
because $\cor_{l_{b_k},u_{b_k}}(u,v)$ is more familiar, but 
in some instances $\Ps_{l_b,u_b}$ appears to have more power to
reveal tail dependence than does $\cor_{l_{b_k},u_{b_k}}(u,v)$. 
We define $\Ps_{l_b,u_b}$, using the bounds
$u+v=2l_b$ and $u+v=2u_b$, as follows. For a distance $h$, we define
$S(h)$ to be the number of points $(u_i,v_i)$ within the bounds 
and a distance less than $h$ from the line $v=u$, divided by the 
total number of points within the bounds. This function is
defined for $h$ going from $0$ to a distance $h_{\text{max}}$ which
is half the longer of the two segments obtained by intersecting the
bounds with the unit square. It is easy to see $S(0)=0$ and 
$S(h_{\text{max}})=1$. We define $S_i(h)$, also for $h$ going from $0$
to $h_{\text{max}}$, to be the area within the bounds and the unit square
and within distance $h$ of the line $v=u$, divided by the area
within the bounds and the unit square. This is the expected value of
$S(h)$ for independent data. We then define
\begin{equation}\label{eq.P}
   P_{l_b,u_b} = \int_0^{h_{\text{max}}} ( S(h) - S_i(h) ) dh.
\end{equation}
\noindent As for $\cor_{l_b,u_b}$, larger values of $\Ps_{l_b,u_b}$ 
indicate stronger positive association
between $u$ and $v$ in the region given by the bounds.

\begin{figure}[!h]
\begin{center}
\includegraphics[width=6 cm,height=6 cm]{./stat_image.jpg} 
\caption[For definitions of non-parametric statistics]{Schematic diagram supporting definitions
of non-parametric tail dependence statistics. The blue and red lines are, 
respectively, $u+v=2l_b$ and $u+v=2u_b$.\label{fig_stat_image}}
\end{center}
\end{figure}

Our third statistic, $\Dsq_{l_b,u_b}(u,v)$, is the average squared 
distance between points satisfying $u_i+v_i>2l_b$ and 
$u_i+v_i<2u_b$ and the line $v=u$. Unlike $\cor_{l_b,u_b}$ and 
$\Ps_{l_b,u_b}$, which are large when points satisfying $u_i+v_i>2l_b$ and 
$u_i+v_i<2u_b$ cluster close to the line $v=u$, $\Dsq_{l_b,u_b}$ is 
small in that case. 
Thus large values of $\cor_{l_b,u_b}$ and $\Ps_{l_b,u_b}$ indicate strong 
dependence in the portions of the distributions of $u$ and $v$ given by 
the bounds, whereas small values of 
$\Dsq_{l_b,u_b}$ indicate strong dependence. 

For large data sets (large $n$),
we could use $l_b$ and $u_b$ close together without incurring undue
sampling variation in our statistics, and we could consider 
several different bands $(l_b,u_b)$ to understand how dependence
varies in different parts of the distributions. But for data sets with 
smaller $n$ we considered only $l_b=0$, $u_b=0.5$ and $l_b=0.5$, $u_b=1$ to see 
the dependence in lower and upper tail of the copula.
We use the shorthand $\cor_l=\cor_{0,0.5}$ ($l$ is for "lower") 
and $\cor_u=\cor_{0.5,1}$ ($u$ is for "upper"); likewise $\Ps_l=\Ps_{0,.5}$,
$\Ps_u=\Ps_{0.5,1}$, $\Dsq_l=\Dsq_{0,0.5}$, and $\Dsq_u=\Dsq_{0.5,1}$. 

To test for asymmetry of dependence in upper and lower portions of distributions,
we used differences of lower and upper statistics.
The difference $\cor_l-\cor_u$ is expected to be positive if 
dependence in the left halves of the distributions is stronger 
than dependence in their right halves; likewise for $\Ps_l-\Ps_u$.
The difference $\Dsq_u-\Dsq_l$ (note the opposite order), is also expected to be 
positive under the same conditions. These statistics were used for smaller data sets.

# Comparing results from two approaches \label{compare_methods} 

<!--Need to ask how should I compare : like fL, fU only for sp-sp interaction from model sel and npa?-->

<!--At this moment this is written only for jrg results, we need to add hays results too later-->
From model selection approach, we got results of more lower tail-dependence when we considered pairwise copula
for some screened species percent cover data over 36 years. To ensure our finding we also used alternative methods,
i. e., non-parametric analysis to implement 3 statistics ($\cor_l -\cor_u$, $\Ps_l-\Ps_u$ and $\Dsq_u-\Dsq_l$).
Using each statistics we got similar interaction matrix (Fig. \ref{fig_jrg_spaceavg_npa}) as of
Fig. \ref{MT-fig_LTmUT_spaceavg_jrg} in the main text
and counted the number of lower and upper tail dependent cells which were positively correlated. The result
(i.e. major lower tail depence, $nL > nU$) was similar. The mere discrepancy arises due to the fact for 
non-parametric analysis used a much wider boundary to see tail-dependence (due to smaller sample size)
whereas model selection result was based on extreme regime.

# Resampling methods to generate correlation preserving Normal copula \label{skew_ncsurrog} 

<!-- This section is adapted from BIVAN----------->
For multivariate datasets (e.g. a matrix with biomass or basal cover timeseries for each plant species along each column),
surrogates were produced as follows:

- Given data $x_i(t)$ for $i=1,\ldots,N$ and $t=1,\ldots,T$, let $\tau_{ij}$ be the Spearman (or Kendall) 
correlation of $x_i(t)$ and $x_j(t)$.
- Calculate the covariance matrix of a multivariate normal distribution with standard-normal
marginals and with pairwise Spearman (or Kendall) correlations equal to the $\tau_{ij}$. This is possible
using the `iRho` function (or the `iTau` function) of the `copula` package. 
- Generate data $a_i(t)$ for $i=1,\ldots,N$ and $t=1,\ldots,T$ by taking $T$ independent draws
from the the multivariate normal distribution of the previous step.
- For any $i,t$ for which the datum $x_i(t)$ was missing, replace $a_i(t)$ by `NA`.
- For each $k$ and $i$ for which $a_i(t)$ is not `NA`, replace the 
$k$th-smallest (non-`NA`) element of the time series 
$a_i(t)$, $t=1,\ldots,T$ by the $k$th smallest (non-`NA`) 
element of $x_i(t)$, $t=1,\ldots,T$.
Call the result $b_i(t)$. This is a surrogate dataset.

\noindent Our code for this algorithm is the function [`ncsurrog`](https://github.com/sghosh89/CSS/blob/master/ncsurrog.R).
The code for the Kendall version of the
algorithm throws an error if there are ties in any of the time series. This is
because the Kendall correlation in the very commonly used `cor` function in R 
is the Kendall tau-b coefficient in the event of ties, and index which 
differs in its definition from the commonly used tau-a that works when there are
no ties; and `tau` and `iTau` are intended for continuous copulas, which cannot 
produce data with ties. Our code also throws an error in the event that
the matrix generated in the second step is not positive semidefinite. Because
ties are common in our data, we only used the Spearman case in analyses using `ncsurrog`,
though, for expansibility, the `ncsurrog` code itself is written to handle 
the Kendall case as well when there are no ties.
 
Because, for each $i$, the final time series 
$b_i(t)$ is a permuted version of $x_i(t)$ (and with `NA`s for the same $t$), 
the marginal distributions of the surrogate dataset (i.e., the distributions of 
values for each sampling location, $i$) are exactly the same as for the original data.
Because ranks are preserved in passing from $a_i(t)$ to $b_i(t)$, pairwise Spearman 
(or Kendall) correlations for the $b_i(t)$ will be the same as those of the $a_i(t)$. 
Discrepancies between the $\tau_{ij}$ and the pairwise Spearman (or Kendall) 
correlations of the $b_i(t)$ will therefore come about only from the presence of NAs
and from sampling variation. 
These discrepancies should be minor if the 
numbers of NAs are not too large and $T$ is not too small. 

If the covariance matrix is not positive semi-definite, surrogates $b_i(t)$ are generated with nearest 
positive semidefinite covariance matrix and our code throws a warning. A histogram is made with the probabilities 
of each pairwise correlations (Spearman or Kendall) of all $b_i(t)$ greater than 
the corresponding pairwise correlations (Spearman or Kendall) of $a_i(t)$. 
For an acceptable nearest positive semidefinite covariance matrix, this histogram 
should spread around 50\% probability with no extreme tail.


<!--Make a table with species list-->
```{r make_tab_splist_for_jrg, echo=F, results="asis"}
library(kableExtra)
library(dplyr)
tab_spinfo<-as.data.frame(matrix(NA,nrow=42,ncol=3))
colnames(tab_spinfo)<-c("ID","Sp. code","Species name")
tab_spinfo$ID<-c(1:42)
tab_spinfo$`Sp. code`<-names(data_jrg_spaceavg$jrg_spaceavg_cover_byyear)
splistfullnm<-c("Agoseris heterophylla","Minuartia douglasii","Astragalus gambelianus",
                "This is bare land","Brodiaea spp.","Bromus hordeaceus","Don't know?","Bromus berteroanus",
                "Calandrinia ciliata","Calycadenia multiglandulosa","Chlorogalum pomeridianum","Don't know?",
                "Epilobium_brachycarpum","Eschscholzia alifornica","Hesperevax sparsiflora","Gilia clivorum",
                "Hemizonia congesta","Lasthenia californica","Layia platyglossa", "Don't know?",
                "Lepidium nitidum","Leptosiphon parviflorus","Lolium multiflorum","Lotus wrangelianus",
                "Lomatium utriculatum","Melica californica","Bombycilaena californica","Microseris douglasii",
                "Don't know?","Castilleja densiflora","Plantago erecta","Plagiobothrys nothofulvus","Poa secunda",
                "This is rock","Elymus multisetus","Nassella pulchra","Don't know?",
                "Crassula connata","Trifolium albopurpureum","Trifolium sp","Trifolium willdenovii","Vulpia microstachys"
)
#tab_spinfo$`Species name`<-c(splistfullnm,"Precipitation for growing season","Average temperature for growing season",
#                             "Maximum temperature for growing season","Minimum temperature for growing season")

tab_spinfo$`Species name`<-c(splistfullnm)

#tab_spinfo[c(1:42),3]<- paste0("\\textit{", tab_spinfo[c(1:42),3], "}")
#tab_spinfo[c(1:42),3]<-cell_spec(tab_spinfo[c(1:42),3],"latex",italic=T)
knitr::kable(tab_spinfo, 
             format="latex", align="c", linesep = "",
             caption = "Information of the species considered for Jasper Ridge data \\label{tab_spinfo}", 
             booktabs = T,col.names = NULL) %>%
             row_spec(splist_jrg_spaceavg, bold = T, color = "blue")%>%
             column_spec(3,italic=T)%>%
             add_header_above(c("ID"=1,"Sp. code"=1,"Species name"=1))
```

<!--jrg : npa results plot -->
\begin{figure}[!h]
\begin{center}
\textbf{ \hspace{0.5 cm} (A) \hspace{8 cm} (B)} \\
\includegraphics[width=8.5 cm]{./Results/jrg_results/jrg_npa_results/jrg_spaceavg/jrg_spaceavg_Corl-Coru.pdf}
\includegraphics[width=8.5 cm]{./Results/jrg_results/jrg_npa_results/jrg_spaceavg/jrg_spaceavg_Pl-Pu.pdf}\\
\vspace{1 cm}
\textbf{ \hspace{1 cm} (C) } \\
\includegraphics[width=8.5 cm]{./Results/jrg_results/jrg_npa_results/jrg_spaceavg/jrg_spaceavg_D2u-D2l.pdf}\\
\caption{ Non-parametric results for JRBP space average data for $(A)$ $\cor_l - \cor_u$, $(B)$ $\Ps_l - \Ps_u$ and
$(C)$ $\Dsq_u-\Dsq_l$. $nL$ and $nU$ indicate the numbers of lower tail and upper tail dependent cells (with positive correlation), respectively.\label{fig_jrg_spaceavg_npa}}
\end{center}
\end{figure}

<!--adding figues for example from jrg_spaceavg results-->
\begin{figure}[!h]
\begin{center}
\includegraphics[width=17 cm]{./Results/jrg_results/jrg_spaceavg_BRMO_PLER.pdf}
\caption[Invasion-effect on native species \textit{Plantago}  
by exotic species \textit{Bromus} over years.]
{Invasion-effect on native species \textit{Plantago}  
by exotic species \textit{Bromus} over 36 years (1983-2018): 
abundance of native species \textit{Plantago erecta} (sp31 plotted along y-axis)
and invasive species \textit{Bromus hordeaceus} (sp6 plotted along x-axis) were negatively 
correlated over years (left plot) and certain years of \textit{Bromus}-invasion made \textit{Plantago}
rare on those years which was reflected in the upper tail-dependence of the copula (right plot :
\textit{Plantago} was plotted with negative abundance so that copula became positively correlated).
 \label{fig_jrg_spaceavg_invasion}}
\end{center}
\end{figure}

\begin{figure}[!h]
\begin{center}
\includegraphics[width=8.5 cm]{./Results/jrg_results/jrg_spaceavg_HELU_LOSU.pdf}\\
\includegraphics[width=17 cm]{./Results/jrg_results/jrg_spaceavg_HELU_MIDO.pdf}\\
\includegraphics[width=17 cm]{./Results/jrg_results/jrg_spaceavg_LOSU_MIDO.pdf}
\caption[Inter-specific dynamics among native annuals over years]{spatially averaged inter-species 
dynamics in JRBP throughout the years (1983-2018): upper panel showed upper tail dependence with 
synchronous abundance between two native annuals \textit{Hemizonia congesta} (sp17: HELU)
and \textit{Lotus wrangelianus} (sp24: LOSU), middle and lower pannel showed compensatory
dynamics between those species with another native annual \textit{Microseris douglasii} (sp28: MIDO) 
making MIDO rare in their good years (see upper tail-dependence in positively correlated species pair).  
sp$_{-}$x and sp$_{-}$y are the id of species plotted along x- and y-axis, 
respectively.\label{fig_jrg_spaceavg_competition}}
\end{center}
\end{figure}

<!--
\begin{figure}[!h]
\begin{center}
\includegraphics[width=8.5 cm]{./Results/jrg_results/jrg_spaceavg_ORDE_ppt.pdf}\\
\includegraphics[width=17 cm]{./Results/jrg_results/jrg_spaceavg_BRSP_ppt.pdf}
\caption[Drought effect on serpentine grassland over years]{Extremely little 
precipitation (averaged over growing season) in some years limit annual species
\textit{Castilleja densiflora} (sp30: ORDE) abundance whereas perrenial 
\textit{Brodiaea spp.} (sp5) showed excessive growth. \label{fig_spaceavg_drought}}
\end{center}
\end{figure}-->


<!--hays : npa results plot -->
\begin{figure}[!h]
\begin{center}
\textbf{ \hspace{0.5 cm} (A) \hspace{8 cm} (B)} \\
\includegraphics[width=8.5 cm]{./Results/hays_results/hays_npa_results/hays_spaceavg/hays_spaceavg_Corl-Coru.pdf}
\includegraphics[width=8.5 cm]{./Results/hays_results/hays_npa_results/hays_spaceavg/hays_spaceavg_Pl-Pu.pdf}\\
\vspace{1 cm}
\textbf{ \hspace{1 cm} (C) } \\
\includegraphics[width=8.5 cm]{./Results/hays_results/hays_npa_results/hays_spaceavg/hays_spaceavg_D2u-D2l.pdf}\\
\caption{ Non-parametric results for Hays space-averaged data for $(A)$ $\cor_l - \cor_u$, $(B)$ $\Ps_l - \Ps_u$ and
$(C)$ $\Dsq_u-\Dsq_l$. $nL$ and $nU$ indicate the numbers of lower tail and upper tail dependent cells (with positive correlation), respectively.\label{fig_hays_spaceavg_npa}}
\end{center}
\end{figure}


\clearpage

# References

\indent

















