---
title: "Species relationships in extreme times and their specific influence on community stability"
author:
 - Shyamolina Ghosh\textsuperscript{1}, Daniel C. Reuman\textsuperscript{1,2,\dag}
 - \textsuperscript{1}Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA; \textsuperscript{2}Laboratory of Populations, Rockefeller University, 1230 York Ave., New York, NY 10065, USA
date: '\textsuperscript{\dag}Correspondence: Daniel Reuman, 2101 Constant Ave, Lawrence, KS, 66047, reuman@ku.edu, 626 560 7084'
fontsize: 12pt
geometry: "left=1 in,right=1 in,top=1 in,bottom=1 in"

output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes

header-includes:
      - \usepackage{xr} \externaldocument[SI-]{SI_spatial_avg}
      - \input{head_maintext.sty}

mainfont: Times New Roman 
tables: True
link-citations: True
urlcolor : blue
indent : True
csl: ecology-letters.csl
bibliography: REF_CSS.bib
---

<!--***DAN: store alternative titles here, decide on one closer to the end
1) Skewness ratio: a complimentary measure for variance ratio and community stability
2) A complete description of synchrony and compensatory dynamics yields a better understanding of community stability
3) Asymmetric tail association, skewness and community stability
4) Asymmetric tail association, skewness and community variability 
5) Asymmetric tail association affects community stability
6) Species relationships influence community stability in more ways than classical approaches reveal. This is OK, but
may make people think of it as a methods paper?
7) Through thick and thin: species relationships in extreme times and their specific influence on community stability 
8) Species relationships in extreme times and their specific influence on community stability
-->

<!--***DAN: Shyamolina, please go ahead and format the title page appropriately, making the proper affiliations
appear and so on
***Shya: affiliation added, I remember Prof. Foster and Prof. Bever listened to your talk and gave input, should not I include them as co-authors?
***DAN: Good question. I don't think their contribution rises to the level of authorship yet, but I've added them to the 
acknowledgments, and I think we should send them a draft at some point and see if they want to contribute more. How does that 
sound to you?
***Shya: Fine for me.-->

```{r setup_Paper, echo=F}
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 5) #This option round all numbers appeared in the inline r code upto 5th digit
```

<!--Abstract-->
\newpage

\noindent \textbf{ABSTRACT} 

<!--keywords-->
\textbf{\textit{Keywords:}} variance ratio, community-stability, synchrony, tail-association, grassland, skewness


\newpage

# Introduction\label{Introduction}

Understanding the extent to which, and the mechanisms by which, species interactions in an ecological 
community help stabilize or destabilize the ecosystem as a whole is a topic that has fascinated ecologists 
for decades [@macarthur1955fluctuations; @paine1969note; @grimm1992application; @pimm1984complexity; @gonzalez2009causes]. 
An important early insight was that an aggregate 
community property such as the total biomass of all species can be relatively stable through time, even 
while the dynamics of individual species are highly variable, if different species exhibit offsetting fluctuations.
This is often refered to as *compensatory dynamics*, because decreases in species abundances are compensated
for by simultaneous increases in other species [@frost1995species;@bai2004ecosystem;@hallett2014]. When species instead exhibit 
positively correlated fluctuations through time, it tends to cause increased variability through time in the community 
aggregate property [@keitt2008coherent;@loreau2008species;@ma2017climate]. This is called *synchrony* because 
species dynamics are partly synchronized in their fluctuations. Thus an important part of what determines 
the variability of an aggregate community property is the nature
of relationships between the dynamics of different species. 

Historically, how species relationships influence community stability, including questions of compensatory 
and synchronous dynamics, have been investigated principally by examining the coefficient of variation through time
of the aggregate community property, together with covariances between species population abundance time series.
For instance, if $x_i(t)$ are data representing the population abundances of species $i=1,\ldots,N$ at the sampling times
$t=1,\ldots,T$, and if $\mu_i=\mean(x_i)$, $v_{ii}=\var(x_i)$, and $v_{ij}=\cov(x_i,x_j)$, community variability
has commonly been quantified using the squared coefficient of variation of $\xtot(t)=\sum_i x_i(t)$, i.e., 
$\CVcomsq=\var(\xtot)/\left(\mean(\xtot)\right)^2=\left(\sum_{i,j} v_{ij}\right)/\left(\sum \mu_i\right)^2$.
And this formula obviously connects to species relationships via the covariances, $v_{ij}$, which appear directly in the formula. Denoting by 
$\CVindsq=\left(\sum_i v_{ii}\right)/\left(\sum \mu_i\right)^2$ the value that $\CVcomsq$ would take if 
the dynamics of each species were independent of the dynamics of all other species (so $v_{ij}=0$ for all $i \neq j$), the 
classic *variance ratio* was defined [@schluter1984variance;@peterson1975] as 
$\phi_{\text{cv}}=\CVcomsq/\CVindsq=\var(\xtot)/\left(\sum_i v_{ii}\right)=\left(\sum_{i,j} v_{ij}\right)/\left(\sum_i v_{ii}\right)$. 
The variance ratio has very commonly been used [@houlahan2007;@winfree2009;@hallett2014] as an index of whether dynamics 
are synchronous or compensatory. If $\phi_{\text{cv}}>1$, the interpretation has been that dynamics are, on balance,
synchronous because then $\CVcomsq>\CVindsq$, i.e., the total community biomass $\xtot$ is more variable than
it would be if species dynamics were independent. Conversely, if $\phi_{\text{cv}}<1$, the interpretation has been
that dynamics are, on balance, compensatory. 

Timescale-specific extensions of the variance ratio [@vasseur2007;
@brown2016;@zhao2020] have revealed that it is possible for compensatory 
dynamics to occur on some timescales while 
synchronous dynamics simultaneously occur on other timescales, and other improvements and alternatives to the variance ratio 
have also been proposed [@loreau2008species]. However, $\phi_{\text{cv}}$ is still very commonly used, 
and the nature of how species relationships influence community stability is likely to be substantially 
more nuanced and interesting than is revealed by either the classic variance ratio approach or
by any existing extensions of which we are aware. To 
begin to illustrate the concepts we will explore in this 
study, and to understand what has been omitted from earlier approaches, we consider two artifically
generated community dynamics datasets (Fig. \ref{fig_pedag_cv2_skw}A, B; data generated as in SI section X).
<!--***DAN: Dan to fill in the X in the above line, and write the corresponding section of the SI.-->
Both model communities consist of $N=10$ species, and data were generated so that species marginal distributions 
(and therefore the means, $\mu_i$, and variances, $v_{ii}$, 
through time) were the same, up to sampling variance, in both cases. Likewise, data were 
generated so that pairwise species covariances, $v_{ij}$ for $i \neq j$,
were essentially the same for Fig. \ref{fig_pedag_cv2_skw}A and B. Thus both $\CVcomsq$ and $\CVindsq$, which 
depend only on the $\mu_i$ and $v_{ij}$,
were the same in both cases, and so $\phi_{\text{cv}}$ was also the same. The Loreau-de Mazancourt variance ratio
[@loreau2008species], which itself depends only on the $v_{ij}$, was also the same, up to sampling variance, in the two cases 
(Fig. \ref{fig_pedag_cv2_skw}A, B). Classical approaches such as these do not distinguish between our two cases, neither in the nature
of species interrelationships nor in the effects of interrelationships on community aggregate dynamics $\xtot(t)$.

Nevertheless, species relationships and resulting aggregate dynamics differed in important ways in our two cases. In both cases,
the ten species could be separated into two groups of five species (red and black lines on Fig. \ref{fig_pedag_cv2_skw}A, B), 
and the dynamics of species in different groups were strongly compensatory. However, in case 1 (Fig. \ref{fig_pedag_cv2_skw}A), 
species in the same group exhibited strongly synchronous dynamics when rare and much less synchronous dynamics when 
common; whereas in case 2 (Fig. \ref{fig_pedag_cv2_skw}B) species in the same group exhibited strongly synchronous dynamics 
when common and much less synchronous dynamics when rare. Dynamics of this kind could occur ecologically, for instance, in case 1, 
if red species in Fig. \ref{fig_pedag_cv2_skw}A were sensitive to an environmental factor such as precipitation, but only when it 
takes values below a threshold. So all the red species are controlled by the same factor, precipitation, when it is below the threshold,
and hence are synchronous when rare. 
When precipitation is above the threshold, the red species are each sensitive, instead, to other, distinct factors, rendering them asynchronous
when common. Black species 
of Fig. \ref{fig_pedag_cv2_skw}A may also be senstive to precipitation, but in a reverse manner, being all simultaneously 
harmed by precipitation when it is
above the threshold and unaffected by precipitation below the threshold. Resulting community dynamics 
(Fig. \ref{fig_pedag_cv2_skw}C-F) were quite different in our two cases because of the distinct species interrelationships.
Total community biomass was left-skewed, frequently crashing to low values, for case 1; but was right skewed, frequently
exploding to high values, in case 2. It is not difficult to imagine cascading ecological ramifications or 
potential applied significance of the distinction our example illustrates. For instance, grazers subsisting on a grass mixture that 
exhibits occasional crashes may experience different population growth prospects than grazers consuming a grass mixture that
instead shows occasional explosions of abundance. 
Thus species interrelationships and their effects on community aggregate dynamics may differ in potentially ecologically
meaningful ways which are nevertheless not detected by classical approaches. 
It is the reliance of earlier approaches on variances, covariance and related linear tools
for quantifying species relationships that causes those approaches to be unable to register the differences
we have illustrated here.
<!--***DAN: Here are a few more changes needed to the figure:
1) On A and B, please provide one more significant figure for CV_com^2 and CV_ind^2, so it will then show 4 decimal places
***Shya: every value in the plot are showed upto 2nd digit (rounded) and for CV^2 upto 4th digit (rounded)
2) I had previously written this:
"3) Please replace \mu on C and D by the approriate rendering of $\mean(x_{\text{tot}})$, and likewise replace
v by the appropriate rendering of $\var(x_{\text{tot}})$. Please also insert $\text{skew}(x_{\text{tot}})$
and the value of that skewness. Please make the formats for all three of these be parallel (currently the skew
is black and to the left, and the mean and variance are blue and to the right), and please also use parallel
formatting choices to what you use in panels A and B to put values on the panels."
But perhaps I did not make myself clear. The numeric values displayed are fine, as far as I can tell at the moment. However, the 
notation "s", "\mu" and "v" is not consistent with the notation used in the text I have been editing. Please replace the notation 
"s" on panels C and D with a proper latex rendering of $\text{skew}(x_{\text{tot}})$. Please replace the notation "\mu" on 
C and D with a proper latex rendering of $\mean(x_{\text{tot}})$. Likewise replace "v" with $\var(x_{\text{tot}})$.
***Shya: Done.
3) With regard to the values p on panels E and F, perhaps I did not make myself clear. There need to be 2 values of p on 
*each panel*, one representing the probability of exceeding the upper threshold, and the other representing the probability
of falling below the lower threshold. The point is to be able to compare the lower-threshold p's across the two panels,
and the p on E should be substantially larger, so the probability of going below the lower threshold is revealed to be greater
on E than it is on F. Likewise, one should be able to compare the upper-threshold p's across the two panels, and the p on F
should be substantially larger, so the probability of going about the upper threshold is revealed to be greater on F than it is on E.
You may need to readjust your thresholds now that the goals here are (hopefully) clear, but it may also be that your current thresholds
will work to reveal the substantial difference in ps between the panels. Not all threshold will reveal the discrepancy in upper 
(respectively, lower) ps equally well. For some choices of threshold there will be very little difference between the panels in ps.
But for other choices of threshold there will be a bigger difference. One way to choose good thresholds might be to
plot the empirical cdf associated with E, and also that associated with F (see the wikipedia page on empirical cdfs if you
don't know what they are) and select thresholds that correspond to large differences between the two empirical cdfs. It is not
necessary to put the plots of the empirical cdf into your figure, but it may help to generate them to choose the best thresholds
for making the point we are trying to make.
***Shya: Done.
-->

This study is centered around three suggestions about how research on these topics should devlop in the future;
and we take some first steps toward implementing these suggestions. First, statistical descriptions of community 
stability/variability that are more nuanced than the coefficient of variation ought to be developed 
and used. The results of Fig. \ref{fig_pedag_cv2_skw} suggest that measures related to skewness may
be useful first steps. Second, descriptions of species relationships that are more nuanced than the standard 
covariance/correlation approaches ought to be developed and applied.
Fig. \ref{fig_pedag_cv2_skw} suggests that measures might be
useful that isolate the extent to which species abundances are more related to each other when the species
are common, or rare. Third, we ought to then study how species relationships
influence community stability/variability using the nuanced descriptors. 

The core ideas of this study relate to rare events, and specifically to how the relationships between the constituents of 
an aggregate quantity change during rare events. There are strong conceptual and methodological connections to
risk pricing in finance. A portfolio of investments is supposed to reduce risk if the constituent investments 
are negatively correlated or uncorrelated. But if these constituents become positively correlated, it can instead accentuate risk. 
Some observers have blamed the 2008 financial crisis on a trend during which many analysts estimated correlations between housing default
risks based on data from normal times, not taking into account that in a crisis, default risks become much more correlated.
In such times, financial products based on aggregating mortgages become riskier due to the increased correlation. 
A single modelling approach [@li2000] was apparently widely used [@salmon2009]. The relationship between two 
quantities, be they investment risks or species populations, can probably never be completely captured by a single number
such as a covariance [@cheung2013], nor considered to be constant through time. Just as mortgage defaults which were typically uncorrelated 
became correlated when the macroeconomic situation worsened, it seems likely that abundances of two species in a community may
be more or less correlated with each other under different circumstances. Therefore classical approaches that characterize relationships
between species using covariances may be neglecting something important. In particular, correlations between species 
may change as global climate change progresses, or when extreme climatic events impact an 
ecosystem [@Ghosh_extinction]. Some financial analysts 
have learned these lessons and have begun developing the necessary mathematics for more appropriate models [@cheung2013]. Ecologists 
can benefit from application of the same methods, and we hope this study helps begin that process.

The goals of this study are as follows, and parallel the research suggestions listed above. We will develop the 
concepts of an approach to studying the relationships
between species that complements classic approaches relying on covariances. We will also develop the concepts of an
approach to studying aggregate community stability/variability that complements the traditional use of the 
coefficient of variation. Finally, we will study how species interrelationships influence community stability variability
using the new approaches. Our results provide a new take on classic questions about the influence of synchronous or 
compensatory dynamics on community stability. We will use theory, as well as data from two iconic, long-term glassland studies:
plant percent cover data from long-term quadrats in mixed-grass prairie located in Hays, Kansas; and annual 
species composition data from the Konza Prairie Lonter-Term Ecological Research (LTER) site, also located in Kansas.
Synchronous versus compensatory dynamics in communities, and their influence on community stability, has most commonly
been studied in plankton systems (REFS) and in grasslands (REFS). Evidence so far suggests that synchonous dynamics may be dominant
and compensatory dynamics rare in plankton systems (REFS), whereas compensatory dynamic appears at least somewhat more common
in grasslands (REFS). One outcome of our empirical work is a suggestion that compensatory dynamics in grasslands may be less 
common than was previously appreciated, when one adopts a broader conceptual view of what constitutes synchronous versus 
compensatory dynamics. Overall, our work seeks to establish the beginnings of a new and more flexible paradigm for
conceptualizing synchronous and compensatory dynamics and their influence on community stability.
<!--***DAN: Don't forget to fill in the references above-->
 
<!--***DAN: Not sure how relevant this stuff is, but keeping it around for now, partly for the references.
There are reasons to focus on skewness to better understand the community-stability 
in this rapidly changing world. Earlier studies [@smith2011ecological; @hoover2014resistance; 
@felton2017integrating] showed climatic events that are extreme and 
sometimes spatially well-spread impact the net productivity of community [@ciais2005europe],
community assembly [@thibault2008impact] and even induce a shift in 
ecotone boundaries [@allen1998drought]. Not only the mean and variance, the symmetry of 
temporal distribution for such climatic signals is also changing [@ummenhofer2017extreme]. This 
change in symmetry results into change in the skewness that can act on the community as well 
as on ecosystem level. Another reason is like variance changing skewness had been 
used earlier as an indicator for changing ecosystem (i.e. for an early 
warning signal, regime shift, etc.) [@guttal2008changing; @guttal2009spatial; 
@dakos2010spatial; @dakos2012methods]. But to our knowledge, there is a gap to incorporate 
this skewness into direct community-stability metric.-->

<!--***DAN: Keeping the following text, may end up included in the Discussion.
A recent study [@Ghosh_copula]
shows tail associations between local quantities affects the 
skewness of spatially averaged
productivity. Likewise, we anticipate the tail-association between 
individual time-series could be responsible for changing skewness on 
an aggregate level. Tail association means a stronger correlation between two 
variables at their extremes than moderate values. If two random variables (say, 
time series for two individual species from a community) are more 
associated in their smaller values than higher then they are having 
stronger 'lower-tail' association (Fig. \ref{fig_pedag_taildep}C) indicating 
both species are going synchronously rare than abundant 
(as shown in Fig. \ref{fig_pedag_cv2_skw}A). Similarly, 
if variables are more associated in their higher values than smaller
then they are having stronger 'upper-tail' association (Fig. \ref{fig_pedag_taildep}D)
indicating both species are going synchronously abundant than rare 
(as shown in Fig. \ref{fig_pedag_cv2_skw}B). A finite 
difference between lower- and upper-tail association indicates 'tail-asymmetry' 
between interspecific response over the years. Tail-asymmetry is known to
have significant effect on population-extinction risk [ERC_ecosphere]
and hence could be related to stability on the population, community and even ecosystem level.
For example, the lower tail association could cause the community 
likely to crash at once - making the community less stable.-->

<!--p6: Our objectives:
(Q1) Could we find an overall tail association (L/U) in a community which arises because of  
synchronous/ compensatory species interaction? [answer by pscor]
(Q2) If we do, then how does tail-association pattern explain the underlying mechanism 
affecting the overall skewness of the community? More specifically, could this
assymetric sp. interaction explain the community stability which we might miss 
with the classic variance ratio method? [answer: Fig 1b hidden box revealed]
We will answer these Qs with two grassland community datasets: Hays & Konza.-->

<!--***DAN: These framings of the objectives are too technical for the reader to understand right now,
keeping for possible use at end of Theory section.
In this paper, we will explore the potential for asymmetric tail associations 
to assess nonlinear interactions among species in a community and to 
unravel any hidden mechanism - not detected by the usual variance ratio approach -
for stabilizing (or destabilizing) a community. Specifically, we will address 
the following sets of questions: (Q1) In a community, could we find 
asymmetric tail associations (lower and/ or upper) that arise because of 
synchronous/ compensatory interaction between species? Do those interactions 
make the community overall lower-tail or overall upper-tail asymmetric? 
(Q2) If we do, then how does the tail association pattern 
explain the underlying mechanism affecting the overall 
skewness of the community? To be specific, we seek for 
a route map to predict stability for an overall tail-asymmetric 
community, based on a 'skewness ratio' approach. For (Q1), we use partial 
Spearman correlation measures [@Ghosh_copula; ERC_ecosphere] focusing 
on the extremes of pairwise species interaction. For (Q2) we disentangle
the overall contribution in variance-/ skewness-ratio 
into two distinct parts: one from the usual correlation and the 
other from the tail association. We tested our theoretical 
framework for assessing stability measure and detecting tail-asymmetry for 
a community with two long-term grassland datasets: basal cover data of vascular 
plant species from Hays and plant species composition data from Konza prairie. 
To our knowledge, though the potential of tail association in population 
ecology [@Ghosh_copula; ERC_ecosphere] has been recently studied, using it 
on the community level to assessing variability-stability relationship remains 
unexplored. Our essential goal is to advance the idea that tail
associations may also be important in this context. Our questions are 
also an important step for predicting net productivity, 
community reorganization, etc. through monitoring skewness over years.-->

<!--idea: 
- can we make specific outcome oriented 
community by choosing species or a cluster of sp.?
- could change in skewness/ phi_s indicate species reordering 
similar to that of early warning signal 
used for regime shift?-->

<!--Tables
S1: splist for hays
S2: splist for knz
-->

# Theory \label{Theory}



# Methods\label{Methods} 

<!--NOTE: if you can, just separate theory and methods section.-->

<!--1. For Q1: 

(Q1) In a community, could we find asymmetric tail associations (lower and/ or upper) that arise because of
synchronous/ compensatory interaction between species? Do those interactions make the
community overall lower-tail or overall upper-tail asymmetric?

      - introduce partial Spearman correlation to measure tail asymmetry corl - coru (need schematic diagram)
      - corl - coru in community context, count on L, U (+ve correlation only)
      - binomial and significance testing: at present not shown-->

<!--Defining partial Spearman correlation: measure of tail-asymmetry-->
To answer Q1 from \nameref{Introduction}, we need a tool to measure the tail asymmetry between 
interacting species over years in a grassland community that is intended to study. We used 
the *partial Spearman correlation* approach (first introduced in @Ghosh_copula) to 
estimate the association between a pair of interacting species' time-series, i.e., whether 
they are strongly correlated in their common good/ bad years (synchronous dynamics) or 
one species' abundance in certain 'good' years limits the growth for the 
other (compensatory dynamics). From a data perspective, consider 
a set of two variables, i.e. time series for any two species,
$\{ u_t, v_t\}, t = 1, 2, \ldots , T$. If $\{ \bar{x_t}, \bar{y_t}\}$ 
are the	corresponding ranks of $\{ u_t, v_t\}$, then a scatter plot with 
the "normalized rank" $\{ x_t, y_t\} = \{ \bar{x_t}, \bar{y_t}\} / (T+1)$ 
reveals the associated dependence pattern 
hidden in the original timeseries of $\{ u_t, v_t\}$. 
This scatter plot of $\{ x_t, y_t\}$, confined within a unit square, 
is known as a bivariate *copula* plot.
*Copula* is a statistical tool tailored to 
estimate tail-dependence and can isolate the dependence 
information from its marginals [@joe2014_dependence; 
@nelsen2006_copula; @MaiScherer2017]. However, computationally 
low-cost non-parametric approaches are available to estimate tail association
in the either extremes for this *copula* plot [@Ghosh_copula]. Following we will give a brief 
description of such a non-parametric measure of tail-association.

First, we define the *partial Spearman correlaion* for a given 
species pair time series ($u(t), v(t)$) as follows;

\begin{equation}
\cor_{l_b,u_b}(u,v) = \frac{\sum (x(t)-\mean(x))(y(t)-\mean(y))}{(T-1)\sqrt{\var(x) \var(y)}},\label{PartialSpearmanEq}
\end{equation}
\noindent where $x$ and $y$ are the normalized ranks of 
$u$ and $v$, respectlively, as stated before. Sample means 
and variances are computed using all the data but the sum is computed only
over the $t$ such that $x(t)+y(t) > 2l_b$ and $x(t)+y(t)<2u_b$ (i.e. colored data points lying in 
between two bounds as in Fig. \ref{fig_pedag_taildep}C-D). The partial Spearman correlation 
is the contribution of those colored data points between bounds in the total Spearman
correlation of $u$ and $v$. For an asymmetric relationship 
between a species-pair, association in one extreme of their copula plot would be
stronger than the other extreme. For example, Fig. \ref{fig_pedag_taildep}C has a 
stronger partial Spearman correlation between the red points in the lower portion 
than the blue points in the upper part, while Fig. \ref{fig_pedag_taildep}D shows 
the opposite trend. 


The quantity $\cor_{0,0.5}(u,v)-\cor_{0.5,1}(u,v)$ is a way to estimate asymmetry of tail
associations between $u$ and $v$. 
$\cor_{0,0.5}(u,v)-\cor_{0.5,1}(u,v)$ represents the amount by which partial Spearman 
correlation is stronger for the points lying in the lower tail (i.e. 
below the dashed diagonal $x+y=1$ in Fig. \ref{fig_pedag_taildep}C-D) than the upper tail (i.e. 
above the dashed diagonal $x+y=1$ in Fig. \ref{fig_pedag_taildep}C-D). We will represent 
$\cor_{l}-\cor_{u}$ for the shorthand of $\cor_{0,0.5}(u,v)-\cor_{0.5,1}(u,v)$ here 
afterwards. A non-zero value of $\cor_{l}-\cor_{u}$ means tail-asymmetry between the time series of
two species - whether they are synchronizing over years 
or competing with each other. <!--***DAN: please double check this statement-->
For synchronized species-pair, a positive $\cor_{l}-\cor_{u}$ value signifies stronger lower 
tail association (Fig. \ref{fig_pedag_taildep}C) of two 
positively correlated species, whereas a negative value means stronger
upper tail association (Fig. \ref{fig_pedag_taildep}D). Though the aforementioned notion of 
tail-asymmetry measure is constructed for positively correlated species pair keeping in mind, it 
is possible to extend the idea for negatively correlated species. When the 
species are competing (i.e. overall correlation is negative), we can take any one species time 
series as negative (so that now species are positively correlated) and 
make a similar plot as in Fig. \ref{fig_pedag_taildep}C or D (depending on which 
species we are reversing). Species for reversal can be chosen arbitrarily, 
hence only the magnitude, not the sign of tail-asymmetry 
$\cor_{l}-\cor_{u}$ is considered for competing species pair. Therefore, a finite 
value of $|\cor_{l}-\cor_{u}|$ would indicate asymmetric tail association 
between two corresponding species time series $\{ u_t, v_t\}$. In particular, 
the magnitude for compensatory and magnitude as well as the sign for synchronous 
(positive for lower tail and negative for upper tail) dynamics can answer the 
first part of (Q1). 

<!--corl - coru in community context, count on L, U (+ve correlation only)-->
From a community perspective, it is possible to determine if the community as a whole
shows asymmetric tail association and if yes then what is its underlying 
nature - overall lower tail or upper-tail asymmetry. To explore this, consider a 
community with $n$ number of species subdivided 
into three categories: *common* species (present for most of the years), *rare* 
species (only occurs once or twice) and the rest as *intermediate* ones. Throughout our study, 
we assume a $n$-species-community comprised of $T$-years long observations for 
$(n-1)$ *common* species and 
one *pseudo*-species (aggregated time-series 
for *rare* and *intermediate* categories). For
such community, there are $p=n(n-1)/2$ number of unique 
pair-wise interspecific interactions possible. First, for 
each of these species-pairs, we construct the scatter plot with 
the normalized rank of corresponding time-series (i.e. the *copula* plot)
<!-- omitted as of now: 
and test their 
independence using `BiCopIndTest` function from `VineCopula` package implemented in `R`. If 
independence is rejected ($0.05$ significance level), then we proceed to estimate--> 
and measured tail-asymmetry ($\cor_{l}-\cor_{u}$) as described above. For positively 
correlated species-pair, we count how many are with the stronger 
lower-tail (or upper-tail) association, $n_L$ (or $n_U$). These 
numbers along with the sum of each asymmetric 
tail-association estimate, $A_{tot} = \sum_p (\cor_{l}-\cor_{u})$ for 
positively correlated pair, can give us an idea about the 
overall nature of tail-asymmetry 
within the community that answers the second part of (Q1).

<!--omitted as of now: Significance tests for individual and overall asymmetry, tailsignif.R, binomial_sigtest.R
At present not shown, because we want to consider all interactions: weekest to strongest.

Tail-asymmetry could be weaker on individual species-pair, but on an aggregate level can make 
the community strongly tail-asymmetric. To test significantly stronger 
association in one of its extreme tail for a given species-pair, we simulate $10000$ made-up 
species pair with same Spearman correlation but removing their tail-asymmetry. If 
estimated tail-asymmetry $\cor_{l}-\cor_{u}$ on given data lies outside 
the $95\%$ confidence interval of the ones estimated with $10000$ surrogated data, then 
we consider the tail-asymmetric relationship is significant for that species-pair. 
On a community level, we calculated the fraction of significant species-pair among all correlated 
pairs considered (overall significance on the community level, $C_s$). We also perform a binomial 
test to check whether the community shows significantly stronger lower-tail (or upper-tail) association.
-->

<!--2. For Q2:
      - brief intro about the usual way to measure community variability (variance ratio method)
      - then introduce skewness ratio in analogy with variance ratio
      - separate the contributions from tail association and usual correlation (Pearson) 
      - need schematic diagram to show the relation (this diagram will again help to interpret results for Q2 later)
      - somewhere, in results or in discussion we should talk about the aggregated effect of weak interactions
-->

To answer (Q2) from \nameref{Introduction}, our approach was to assess the effect 
of tail-asymmetry between species-pairs that was not accounted for 
classic variance ratio approach. Variability 
through time, be it for individual or for total community biomass, is a key component to
measure the stability [@ives1999stability]. Following we
briefly discuss about the classic variance ratio metric which is generally 
used to predict the community-stability [@schluter1984variance]. 


<!--short theoretical background to calculate phi_cv with variance ratio method, and its interpretation-->
Consider a community with $n$ number of species where individual species biomass 
or productivity ($x_i(t); i = 1, 2, \ldots, n$) being monitored 
through $t = 1, 2, \ldots, T$ years. Mean biomass time series is denoted as 
$\mu_i = \bar{x_i}$ for $i^{th}$ individual species whereas interaction between species
is represented by the covariance $v_{ij} = \cov(x_i,x_j)$. $v_{ij} = 0$ implies
independent fluctuation. On an aggregated scale, the total productivity, mean and the variance 
are represented as $x_{tot} = \sum_{i} x_i$, $\mu_{tot} = \sum_{i} \mu_i$ 
and $v_{tot} = \sum_{i,j}v_{ij}$, respectively. These quantities quantify
squared coefficient of variation ($CV_{com}^2 = v_{tot}/\mu_{tot}^2$) that measures 
the variability of the said community [@pimm1984complexity]. If interspecific 
interaction makes a community more variable compared to independent species
fluctuation, then the community is considered more stable. In mathematical natation, 
this stability index is represented as the classic 
variance ratio, $\phi_{cv}$ ($= CV_{com}^2/CV_{ind}^2 =  \sum_{i,j}v_{ij}/ \sum_{i} v_{ii}$). 
When $\phi_{cv}>1$, community is highly variable compared to a community where species are fluctuating 
independently and randomly. Species with compensatory dynamics (fluctuating time-series 
in anti-phase) makes a community more stable (i.e., $\phi_{cv}<1$) due to different 
functional responses from different functional group of species within the community. 
On the other hand, synchronized fluctuation between species results higher $\phi_{cv}(>1)$ 
and makes community less stable towards 
environmental perturbation compared to an independent community.

<!--alternative measure of stability: based on skewness-->
We here propose an alternative measure of 
stability for a $n$-species community. Accounting for the effect due to 
extreme environmental perturbation, it is reasonable to consider
how much the mean and the median would differ for total productivity of a 
community throughout the years. In such case, we represent 
the skewness for a community as
$S_{com}=\sum_{i,j,k}m_{ijk}/\sum_{i,j,k}v_{ijk}^{3/2} = m_{tot}/v_{tot}^{3/2}$, where 
$m_{tot}$ is the 3$^{rd}$ central moment of the temporal distribution 
for total biomass of the community. If all the species within 
that community behave as independent entities (i.e. no interaction between species), then the skewness 
for an independent community would be 
$S_{ind} = \sum_{i}m_{iii}/\sum_{i}v_{i}^{3/2}$. Therefore, we define the index for
skewness-based change in a community $\phi_{s} = S_{com}/ S_{ind}$ similar to that 
of the variance ratio metric, $\phi_{cv}$. It is trivial to show the relationship
between these two stability indices as $\phi_s = (m_{tot}/\sum_im_{iii})(1/\phi_{cv}^{3/2})$.

<!--interpretation for phi_s and stability-->
Unlike $\phi_{cv}$, $\phi_s$ can be positive, $0$ or negative depending on the 
signs of the skewnesses from the concerned community and its 
independent analog. $\phi_s >1$ indicates that
the community biomass is more positively (or more negatively) skewed
than it would have been if the species have no interactions with each other.
The opposite scenario - i.e., when the community with interacting species shows less positive
or less negative skewness than would be expected if there was no interactions - represents 
$\phi_s$ to be within the range $(0,1)$. $\phi_s \approx 0$ means skewness is eliminated by the 
interactions of the species within the community, i.e., high productivity of some species 
for some years are balanced by its proportional drop in productivity 
for other years or by other species for those same years. <!--***Shya:please review this line, am I right here? 
is this similar as of phi_cv < 1 for compensatory dynamics?--> A negative $\phi_s$ indicates 
interspefic interactions at the extreme values can alter the skewness (i.e. changing its sign) of a 
community-biomass distribution over years than it would have been expected without any interactions. 
<!--for example, see explore_phis.R where a left-tail dep. community 
with slightly right skewed marginals make phi_s -ve.-->


<!--how phi_s and phi_cv are different?-->
We recommend to use both these indices ($\phi_{cv}$ and $\phi_s$) to get 
a complete picture to predict the stability of the community. It is possible
to underestimate the stability status of the community if we only
depend on the $\phi_{cv}$, which is a correlation 
(i.e. normalized covariance) based measure. $\phi_s$, on the other hand, takes 
the extreme values or tail asymmetry between interspecific 
response into account to assess the change in community structure
over time. Therefore, two communities with similar $\phi_{cv}$ could have two drastically 
different $\phi_s$ and interpretation of stability if we consider the change of skewness as an indicator 
of community-change (examples with real data are shown in \nameref{Results}). For example, consider 
two communities $C_A$ and $C_B$ with equal number of species. It is 
possible that the majority of species in $C_A$ show very low productivity for some 
years whereas those in $C_B$ are extremely abundant for some years, though
their overall pairwise correlation remains same. In such case, $C_A$ and $C_B$ 
should show more or less same $\phi_{cv}$ but 
different $\phi_s$, particularly $\phi_s$ for community $C_A$ 
should be less than that for community $C_B$, i.e., $0<\phi_{s,C_A}<1 < \phi_{s,C_B}$. 
<!--***DAN: double check this statement, this is theoretically I expect but in Fig.1 with madeup extreme tail dep community phi_s are same though S_com are different-->
To explain the theoretical basis of such difference 
between $\phi_{cv}$ and $\phi_s$, we make partition for the overall contribution 
in stability metric into two distict parts - due to correlation and
due to tail association for extreme values between interspecific response, as follows. 

<!--partition between correlation and tail association effect in phi_s, phi_cv-->
As we have mentioned earlier, the skewness of a community ($S_{com}$) is related 
with its independent analog ($S_{ind}$) by the scaling factor $\phi_s$ that can be considered 
as a measure of community-change over time. This $\phi_s$ can have two distinct independent
contributions: $\phi_{s,cor}$ (due to only correlation) 
and $\phi_{s,ta}$ (due to tail-asymmetry), i.e., $\phi_s = \phi_{s,cor} \times \phi_{s,ta}$. 
One can consider $\phi_{s,cor}$ as a factor by which skewness of an independent-community 
($S_{ind}$, skewness for species having no interactions) changes to the skewness of 
the community when species show correlated fluctuations but no asymmetric tail-association ($S_{nta}$), 
i.e., $S_{ind} = \phi_{s,cor} \times S_{nta}$. From now on, we will mention the later type of community 
as 'tail-symmetric' community where interspecific response showed no 
stronger correlation in either tail. Theoretically, one can make this tail-symmetric community 
from the given community matrix by removing the asymmetric tail-association 
among species but keeping the pairwise Pearson correlation same (upto sampling variation) via 
algorithm stated in Appendix \ref{SI-alg_pp_com}. Now, if the interspecific response 
are more correlated in their lower or higher values (i.e., asymmetric 
tail-association) over years, then the skewness for the tail-symmetric community 
would change by a factor $\phi_{s,ta}$ such that $S_{com} = \phi_{s,ta} \times S_{nta}$.
We can also consider the corresponding analog for variance ratio metric, i.e., 
$\phi_{cv} = \phi_{cv,cor} \times \phi_{cv,ta}$ but as co-variance does not incorporate the effect
for extreme values, $\phi_{cv,ta}$ would be $\approx 1$. The relations between independent, tail-symmetric 
and the given community with all these metrics are shown as a schematic diagram in Fig. \ref{fig_schematic_box}. 
<!--What to expect for the values of $\phi_s$'s with two different kinds of tail-asymmetry?-->
For a given community where most of the species showed stronger correlation in 
lower values (i.e. stronger lower tail association with $A_{tot}>0$), one can 
expect the change in skewness would be in the order $S_{com} < S_{nta}$ 
and $\phi_{s,ta} < \phi_{s,cor}$ as lower tail association 
tends to suppress the skewness (Fig. \ref{fig_pedag_cv2_skw}C). If the 
community showed stronger tail-association for the higher values of 
species-time series (i.e. $A_{tot}<0$), skewness should change in 
reverse order, i.e., $S_{com} > S_{nta}$ with $\phi_{s,ta} > \phi_{s,cor}$.
This anticipitation is consistent with the fact that upper tail 
association tends to increase the skewness (Fig. \ref{fig_pedag_cv2_skw}D). The 
stronger the tail-asymmetry for the 
interspecific response within the community (i.e. higher $|A_{tot}|$), the larger would be 
the difference between $\phi_{s,cor}$ and $\phi_{s,ta}$. We summarize the 
difference between classic variance ratio approach and our proposed 
skewness ratio approach in Fig. \ref{fig_method_box} that can help to answer (Q2).

The complete reproducible workflow 
for this project is available at https://github.com/sghosh89/Copula_spaceavg. Following 
we will present the results from the analyses with 
two examplary long-term community data described in Appendix \ref{SI-Data}.

# Results\label{Results}

We here present the results from the study carried out with two long-term
grassland community data sets: basal cover data (1932-1972)
of mixed grass priarie near Hays, KS and Konza prairie 
percent cover data (1983-2018) (for details see
Appendix \ref{SI-Data}). 

<!--Results for Q1
(Q1) In a community, could we find 
asymmetric tail associations (lower and/ or upper) that arise because of 
synchronous/ compensatory interaction between species? 

Do those interactions make the community overall lower-tail or 
overall upper-tail asymmetric? 

For Q1: plot with hays and knz corl-coru (Fig 4, panels a,b)-->

For each unique pairwise species combination from 
each of two examplary communities, we computed lower and upper tail 
association (*partial Spearman correlation* method) between 
species over years. The difference (i.e. lower minus upper tail 
association estimates) are presented in 
Fig. \ref{fig_CorlmCoru}A for Hays and B for Konza. 
We found both positively correlated (synchronous) and negatively 
correlated (compensatory) species pairs showed 
asymmetric tail association. For Hays, majority of species pair interaction showed 
stronger lower tail association ($n_L$ = 70) than stronger 
upper tail association ($n_U$ = 40). Negatively correlated pairs,indicated by green dots, 
were excluded while counting $n_L$ and $n_U$ since the magnitude not the sign matters 
for tail-asymmetry with competitive species interaction (see \ref{Methods} for details). 
As the number of interspecific interaction with lower tail asymmetry,$n_L$ was nearly double 
than the number of interspecific interaction with upper tail asymmetry,$n_U$ for Hays, 
the overall tail-asymmetry estimate, $A_{tot}$ was strongly positive, $6.0842$, <!--caution, 
not autolinked, I copied from fig. legend-->suggecting Hays community was strongly 
lower tail asymmetric for the $1932-1972$ study period (Fig. \ref{fig_CorlmCoru}A). 
On the other hand, for Konza (Fig. \ref{fig_CorlmCoru}B), majority of species pair 
interaction showed stronger upper tail association ($n_U$ = 82) than stronger 
upper tail association ($n_L$ = 70), though the difference between $n_L$ and $n_U$ 
was not that apperent as of Hays. Total asymmetry $A_{tot}$ estimates for Konza
was slightly negative, $-1.3496$, <!--caution, 
not autolinked, I copied from fig. legend-->making the Konza community 
overall upper tail asymmetric. These observations answered (Q1).

<!--Results for Q2

(Q2) How does the tail association pattern 
explain the underlying mechanism affecting the overall 
skewness of the community? To be specific, we seek for 
a route map to predict stability for an overall tail-asymmetric 
community, based on a 'skewness ratio' approach.

For Q2: Fig. 5-->

To answer (Q2), we followed the route map of monitoring the 
change of variance as well as of skewness as 
shown in Fig. \ref{fig_result_box}A-D. We tracked the changes 
through three states of the given community (Hays and Konza); they 
are: the independent community (species having no interaction), 
tail-symmetric community (species with correlation but no tail-association), 
and the actual community (species having correlation as well 
as tail association). For Hays, variance ratio $\phi_{cv}$ was less than 1 
indicating stable community than the independent 
fluctuation (Fig. \ref{fig_result_box}A). For Konza, $\phi_{cv}$ concluded 
the same (Fig. \ref{fig_result_box}C). Both communities have 
$\phi_{cv} \approx \phi_{cv,cor}$ as tail-association did not contribute
to the change in variance (i.e., $\phi_{cv,ta} \approx 1$). But our proposed 
approach detected the difference between the two communities. Skewness ratio 
$\phi_s = 0.2911$ for Hays was much less than 1, and mainly affected by 
the tail-asymmetric contribution as $\phi_{s} \approx \phi_{s,ta}$ and 
$\phi_{s,cor} \approx 1$ (Fig. \ref{fig_result_box}B). This observation was consistent with our 
earlier finding (i.e. answer for second part of Q1) that species in Hays 
showed stronger lower tail association on overall community level. Lower tail association 
makes a community more negatively skewed making total productivity *less stable* as 
species could crash altogether unexpectedly. On the other hand, for Konza, skewness ratio 
$\phi_s = 7.3811$ was much higher than 1, meaning a community 
with consistently high productivity - so *more stable*. This finding was also 
consistent with the fact that species in Konza showed major upper-tail 
association in our earlier findings. Also note, as total tail-asymmetry, $A_{tot}$, for Konza was not 
as large as $A_{tot}$ for Hays, there was slight difference between 
$\phi_{s,ta}$ and $\phi_{s,cor}$ for Konza. Fig. \ref{fig_result_box}(E-H) is a 
pictorial representation of the summary result shown 
in Fig. \ref{fig_result_box}(A-D) for squared coefficient of 
variation, $CV^2$, and skewness, $S$, for 
actual community and independent community compared
to $10000$ tail-symmetric surrogate 
communities we made up via algorithm stated in Appendix \ref{SI-alg_pp_com}. This 
example with two community datasets showed two tail-asymmetric communities could have 
same variance ratio but contrasting skewness ratio because of opposing tail 
asymmetric nature they had - which answered (Q2).


# Discussion\label{Discussion}




# Acknowledgments
\noindent The authors thank Jim Bever and Bryan Foster for helpful discussions. The authors were partly supported 
by U.S. National Science Foundation grant 1714195, the James S. McDonnell Foundation, and the California Department
of Fish and Wildlife Delta Science Program. 

<!--add figures-->
<!--Pedagogical figure for same variance ratio but different skewness-->
\begin{figure}[!h]
\begin{center}
\includegraphics[width=16cm]{./Results/pedagog_figs/pedagog_cv2_skw.pdf}
\caption{Pedagogical figure showing two hypothetical communities having two functional groups each.
Community shows compensatory dynamics between groups but synchronous dynamics within groups. Similar 
variance ratios, $\phi_{cv}$ for both communities though species are synchronously $(A)$ rare and 
$(B)$ abundant, respectively. Total community-biomass have exactly same mean, $\mu$, and similar temporal variance $v$, throughout years but time-series are $(C)$ negatively ($s<0$) and $(D)$ positively ($s>0$) skewed, making 
the whole communities $(E)$ left-tail and $(F)$ right-tail dependent, respectively. Timeseries are generated for $10000$ years, but showed for initial $60$ years in $(A-D)$ for simplicity. Dashed and dotted lines show lower and higher extreme threshold for total productivity of extremely bad years ("catastrophes") and extremely good years ("bonanzas"), respectively.\label{fig_pedag_cv2_skw}}
\end{center}
\end{figure}


<!--Pedagogical figure for variance-ratio and skewness-ratio idea and asymmetric tail association-->
\begin{figure}[!h]
\begin{center}
\hspace{0.5 cm}
\includegraphics[width=13cm]{./Results/pedagog_figs/pedagog_simple_cv2_skw.pdf}\\
\includegraphics[width=13 cm]{./Results/pedagog_figs/LTUT_rho_0.8.pdf}
\caption{Upper panel shows a schematic diagram of the known $(A)$ variance-ratio approach usually used
to assess community-stability and our proposed $(B)$ skewness-based analog; \textit{CV} and \textit{S} denote 
coefficient of variation and skewness, respectively. White boxes with dashed arrows indicate a missing link between 
the two extremes: an actual community ($com$) having both correlation and tail 
association between species and its independent ($ind$) analog with no
interspecific interaction. This is explored in detail later (Fig. \ref{fig_method_box}).
Lower panel shows pedagogical
figures of asymmetric tail associations between $200$ observations of 
two positively correlated (same Spearman correlation $\rho = 0.8$) random variables $(x,y)$ with 
$(C)$ stronger lower-tail and $(D)$ stronger 
upper-tail association, respectively.\label{fig_pedag_taildep}}
\end{center}
\end{figure}

<!--Pedagogical figure to explain method-->
\begin{figure}[!h]
\begin{center}
\includegraphics[width=12.5cm]{./Results/pedagog_figs/pedagog_complex_cv2_skw.pdf}\\
\includegraphics[width=12.5cm]{./Results/pedagog_figs/method_box_diagram.pdf}
\caption{Schematic diagram showing the difference between two approach: variance-ratio based
and skewness-ratio based. \label{fig_method_box}}
\end{center}
\end{figure}

<!--Results with corl-coru matrix plot-->
\begin{figure*}[!h]
\begin{center}
\textbf{ \hspace{-7 cm} (A) \hspace{7 cm} (B)}\\
\includegraphics[width=8cm]{./Results/hays_results/corstat_hays_spaceavg_results/Corl-Coru_ub_0.5.pdf}
\includegraphics[width=8cm]{./Results/knz_results/corstat_knz_spaceavg_results/soiltype_t/Corl-Coru_ub_0.5.pdf} 
\caption{Results for Q1: Measure of tail-asymmetry (i.e., lower minus upper tail association) for species (Tables \ref{SI-tab_spinfo_hays}, \ref{SI-tab_spinfo_knz}) 
found in (A) Hays and (B) Konza priarie (for details see \nameref{Results}). 
$n_L$ and $n_U$, the count of cells (considered for positive correlation only)
with positive and negative tail-asymmetry values, respectively. 
$n_L>n_U$ (majority of red cells) indicates major lower tail association
in Hays, whereas for Konza it is major upper tail association ($n_L<n_U$).
For initially negatively correlated 
cells (indicated by green dots), we measured the tail asymmetry by taking 
negative of the time series of species shown in column, so the magnitude 
matters only, not the sign or color of the cell. $A_{tot}$ is the total tail asymmetry 
computed considering sum over all positively correlated cell-values.\label{fig_CorlmCoru}}
\end{center}
\end{figure*}

<!--Skewness results for both datasets-->
\begin{figure}[!h]
\begin{center}
\includegraphics[width=14cm]{./Results/pedagog_figs/results_hays_knz_complex_cv2_skw.pdf}\\
\textbf{ \hspace{-5 cm} (E) \hspace{7 cm} (F)}\\
\includegraphics[width=15cm]{./Results/hays_results/skewness_results/hays_pearson_preserving_results_cvsq_skw_plots.pdf}\\
\textbf{ \hspace{-5 cm} (G) \hspace{7 cm} (H)}\\
\includegraphics[width=15cm]{./Results/knz_results/skewness_results/knz_pearson_preserving_results_cvsq_skw_plots.pdf}
\hspace{1 cm}
\includegraphics[width=16cm]{./Results/hays_results/skewness_results/legend_plot.pdf}
\caption{Results for Q2: $(A-B)$ schematic diagram with computed parameter 
values for Hays following the route map given in Fig. \ref{fig_method_box}. $(C-D)$ similar 
diagram but for Konza. $(E-H)$ graphical representation of $(A-D)$ with the actual communities, 
$10000$ tail-symmetric surrogates and independent communities. Both communities show similar 
interpretation for stability as per variance ratio (same $\phi_{cv}$) but contrasting conclusion 
for skewness-based stability approach (different $\phi_s$).\label{fig_result_box}}
\end{center}
\end{figure}

\clearpage

# References
\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{1pt}









